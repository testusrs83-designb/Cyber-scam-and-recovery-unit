(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8871:function(e,t,s){Promise.resolve().then(s.bind(s,4591))},4591:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return o}});var a=s(7437),r=s(2265),n=s(9271),i=s(7138),l=s(6463),d=s(3598);function c(e){let{status:t}=e;return(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat({intake:"bg-slate-200 text-slate-900 dark:bg-slate-800 dark:text-slate-100",under_review:"bg-yellow-100 text-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-200",action_recommended:"bg-emerald-100 text-emerald-900 dark:bg-emerald-900/30 dark:text-emerald-200",closed:"bg-slate-300 text-slate-700 dark:bg-slate-800 dark:text-slate-300"}[t]),children:t.replace("_"," ")})}function o(){let[e,t]=(0,r.useState)([]),s=(0,l.useSearchParams)(),o=(0,l.useRouter)(),m=s.get("id");(0,r.useEffect)(()=>{let e=(0,n.Ee)();t(e),0===e.length&&o.replace("/report?needReport=1")},[]),(0,r.useEffect)(()=>{let e=new BroadcastChannel("csr_cases_global"),s=()=>t((0,n.Ee)());return e.addEventListener("message",s),()=>e.removeEventListener("message",s)},[]);let u=(0,r.useMemo)(()=>e.find(e=>e.id===m)||null,[e,m]);return(0,a.jsxs)("div",{className:"container-responsive py-10",children:[(0,a.jsxs)("div",{className:"flex items-end justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"section-title",children:"Your Cases"}),(0,a.jsx)("p",{className:"section-subtitle mt-2",children:"Track progress and review evidence."})]}),(0,a.jsx)(i.default,{href:"/report",className:"button-secondary",children:"New Report"})]}),(0,a.jsxs)("div",{className:"mt-6 grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"lg:col-span-1 card-surface p-4",children:(0,a.jsxs)("ul",{className:"divide-y divide-slate-200 dark:divide-slate-800",children:[e.map(e=>(0,a.jsx)("li",{className:"py-3",children:(0,a.jsx)(i.default,{href:"/dashboard?id=".concat(e.id),className:"block",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium capitalize",children:e.type}),(0,a.jsx)("div",{className:"text-xs text-[var(--muted)]",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsx)(c,{status:e.status})]})})},e.id)),0===e.length&&(0,a.jsx)("li",{className:"py-8 text-center text-[var(--muted)]",children:"No cases yet. Create your first report."})]})}),(0,a.jsx)("div",{className:"lg:col-span-2 card-surface p-6",children:u?"closed"===u.status?(0,a.jsx)("div",{className:"text-sm",children:(0,a.jsx)("div",{className:"mb-3 rounded-md border border-slate-300 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 p-4",children:"This access link is closed. Your report has been closed by our team. If you believe this is an error, please contact support."})}):(0,a.jsxs)("div",{children:["1"===s.get("submitted")&&(0,a.jsx)("div",{role:"status",className:"mb-4 rounded-md border border-emerald-300/40 bg-emerald-50 dark:bg-emerald-900/20 text-emerald-900 dark:text-emerald-200 px-4 py-3 text-sm",children:"Report received. We will assign a Recovery Unit agent to this chat promptly."}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:"Case Details"}),(0,a.jsxs)("div",{className:"text-sm text-[var(--muted)]",children:[u.amount," ",u.currency," • ",u.type]})]}),(0,a.jsx)("button",{onClick:()=>(function(e){let s=["intake","under_review","action_recommended"],a=s[Math.min(s.indexOf(e.status)+1,s.length-1)],r={...e,status:a};(0,n.MO)(r),t((0,n.Ee)())})(u),className:"button-primary",children:"Advance Status"})]}),(0,a.jsxs)("div",{className:"mt-6 grid md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"Evidence"}),(0,a.jsxs)("ul",{className:"mt-2 divide-y divide-slate-200 dark:divide-slate-800",children:[u.evidence.map((e,t)=>(0,a.jsxs)("li",{className:"py-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:e.name}),(0,a.jsxs)("div",{className:"text-xs text-[var(--muted)]",children:[(e.size/1024).toFixed(1)," KB • ",e.type," • ",e.hash]})]},t)),0===u.evidence.length&&(0,a.jsx)("li",{className:"py-4 text-sm text-[var(--muted)]",children:"No evidence added."})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:"Timeline"}),(0,a.jsx)("ol",{className:"mt-2 space-y-3 text-sm",children:[{k:"intake",t:"Intake received"},{k:"under_review",t:"Under review by analyst"},{k:"action_recommended",t:"Action recommended"},{k:"closed",t:"Case closed"}].map(e=>(0,a.jsxs)("li",{className:"flex items-start gap-3",children:[(0,a.jsx)("span",{className:"mt-1 h-2.5 w-2.5 rounded-full ".concat(u.status===e.k||"intake"===e.k?"bg-brand-green":"bg-slate-300 dark:bg-slate-700")}),(0,a.jsx)("span",{className:u.status===e.k?"font-medium":"",children:e.t})]},e.k))})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(d.N,{sender:"victim",showSystemIntro:!0,record:u,onUpdate:e=>{(0,n.MO)(e),t((0,n.Ee)())}})})]}):(0,a.jsx)("div",{className:"text-[var(--muted)]",children:"Select a case to view details."})})]})]})}},3598:function(e,t,s){"use strict";s.d(t,{N:function(){return l}});var a=s(7437),r=s(2265),n=s(9271),i=s(2333);function l(e){var t,s,l;let{record:d,onUpdate:c,sender:o="victim",showSystemIntro:m=!0}=e,[u,x]=(0,r.useState)(""),[h,p]=(0,r.useState)([]),[g,v]=(0,r.useState)(!1),f=(0,r.useRef)(null),{post:b}=(s=d.id,l=e=>{(null==e?void 0:e.type)==="message"&&e.caseId===d.id&&c({...d,messages:[...d.messages||[],e.message]}),(null==e?void 0:e.type)==="typing"&&e.caseId===d.id&&v(!!e.agent)},(0,r.useEffect)(()=>{if(!s)return;let e=new BroadcastChannel("csr_chat_".concat(s)),t=e=>l(e.data);return e.addEventListener("message",t),()=>e.removeEventListener("message",t)},[s,l]),{post:e=>{s&&new BroadcastChannel("csr_chat_".concat(s)).postMessage(e)}});async function y(e){e&&p(Array.from(e).slice(0,5))}async function j(){if(!u.trim()&&0===h.length)return;let e=[];for(let t of h){let s=await (0,i.O)(t),a=t.type.startsWith("image/")?await new Promise(e=>{let s=new FileReader;s.onload=()=>e(String(s.result)),s.readAsDataURL(t)}):void 0;e.push({name:t.name,type:t.type,size:t.size,hash:s,previewDataUrl:a})}let t={id:crypto.randomUUID(),from:o,text:u.trim(),at:Date.now(),status:"sent",attachments:e},s={...d,messages:[...d.messages||[],t]};(0,n.MO)(s),c(s),b({type:"message",caseId:d.id,message:t}),x(""),p([]),"victim"===o&&(v(!0),b({type:"typing",caseId:d.id,agent:!0}),setTimeout(()=>{let e={id:crypto.randomUUID(),from:"reviewer",text:"Your case is being reviewed. We will follow up shortly with next steps.",at:Date.now(),status:"delivered"},t={...s,messages:[...s.messages||[],e]};(0,n.MO)(t),c(t),b({type:"message",caseId:d.id,message:e}),v(!1),b({type:"typing",caseId:d.id,agent:!1})},1e3))}return(0,r.useEffect)(()=>{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[null===(t=d.messages)||void 0===t?void 0:t.length]),(0,r.useEffect)(()=>{if(m&&!(d.messages||[]).some(e=>"system"===e.from)){let e={id:crypto.randomUUID(),from:"system",text:"Thanks for your report. We will assign a Recovery Unit agent to this chat shortly.",at:Date.now()},t={...d,messages:[...d.messages||[],e]};(0,n.MO)(t),c(t)}},[m]),(0,a.jsxs)("div",{className:"card-surface p-4",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Secure Chat"}),(0,a.jsxs)("div",{className:"mt-3 h-64 overflow-y-auto rounded-md border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-3 space-y-2",children:[(d.messages||[]).map(e=>{var t;return(0,a.jsxs)("div",{className:"max-w-[80%] rounded-md px-3 py-2 text-sm ".concat("victim"===e.from?"ml-auto bg-brand-green text-white":"reviewer"===e.from?"bg-slate-200 dark:bg-slate-800":"mx-auto bg-slate-100 dark:bg-slate-900"),children:[(0,a.jsx)("div",{children:e.text}),(null===(t=e.attachments)||void 0===t?void 0:t.length)?(0,a.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:e.attachments.map((e,t)=>(0,a.jsx)("div",{className:"rounded border border-slate-200 dark:border-slate-800 p-2",children:e.previewDataUrl?(0,a.jsx)("img",{src:e.previewDataUrl,alt:e.name,className:"w-full h-24 object-cover rounded"}):(0,a.jsxs)("div",{className:"text-xs text-[var(--muted)]",children:[e.name," • ",(e.size/1024).toFixed(1)," KB"]})},t))}):null,(0,a.jsxs)("div",{className:"mt-1 text-xs opacity-80 flex items-center gap-2",children:[(0,a.jsx)("span",{children:new Date(e.at).toLocaleTimeString()}),e.status?(0,a.jsxs)("span",{children:["• ",e.status]}):null]})]},e.id)}),g&&(0,a.jsxs)("div",{className:"max-w-[80%] rounded-md px-3 py-2 text-sm bg-slate-200 dark:bg-slate-800 inline-flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce"}),(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce [animation-delay:120ms]"}),(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce [animation-delay:240ms]"})]}),(0,a.jsx)("div",{ref:f})]}),h.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-[var(--muted)]",children:[h.length," attachment(s) ready"]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("input",{value:u,onChange:e=>x(e.target.value),placeholder:"Write a message",className:"flex-1 rounded-md border border-slate-300 dark:border-slate-700 bg-transparent px-3 py-2","aria-label":"Message"}),(0,a.jsxs)("label",{className:"button-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>y(e.target.files),accept:"image/*,application/pdf,text/plain"}),"Attach"]}),(0,a.jsx)("button",{onClick:j,className:"button-primary",children:"Send"})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--muted)]",children:"We will assign a Recovery Unit agent to this chat promptly."})]})}},2333:function(e,t,s){"use strict";async function a(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}s.d(t,{O:function(){return a}})},9271:function(e,t,s){"use strict";s.d(t,{Ee:function(){return r},MO:function(){return n},S:function(){return i}});let a="csr_cases_v1";function r(){try{let e=localStorage.getItem(a);if(!e)return[];return JSON.parse(e)}catch(e){return[]}}function n(e){let t=r(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.unshift(e),localStorage.setItem(a,JSON.stringify(t))}function i(e){return r().find(t=>t.id===e)||null}},7138:function(e,t,s){"use strict";s.d(t,{default:function(){return r.a}});var a=s(231),r=s.n(a)},6463:function(e,t,s){"use strict";var a=s(1169);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[231,971,23,744],function(){return e(e.s=8871)}),_N_E=e.O()}]);