(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{2379:function(e,t,s){Promise.resolve().then(s.bind(s,9852))},9852:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var a=s(7437),n=s(2265),r=s(357);let i="csr_admin_token",l=r.env.NEXT_PUBLIC_ADMIN_EMAIL||"",c=r.env.NEXT_PUBLIC_ADMIN_PASSWORD||"";var o=s(9271),d=s(3598);function u(){let[e,t]=(0,n.useState)(!1),[s,r]=(0,n.useState)(""),[u,m]=(0,n.useState)(""),[p,h]=(0,n.useState)([]),[f,x]=(0,n.useState)(null);if((0,n.useEffect)(()=>{t("ok"===localStorage.getItem(i))},[]),(0,n.useEffect)(()=>{e&&h((0,o.Ee)())},[e]),(0,n.useEffect)(()=>{let e=new BroadcastChannel("csr_cases_global"),t=()=>h((0,o.Ee)());return e.addEventListener("message",t),()=>e.removeEventListener("message",t)},[]),!e)return(0,a.jsx)("div",{className:"container-responsive py-10",children:(0,a.jsxs)("div",{className:"max-w-sm mx-auto card-surface p-6",children:[(0,a.jsx)("h1",{className:"section-title text-xl",children:"Admin Login"}),(0,a.jsxs)("div",{className:"mt-4 space-y-3",children:[(0,a.jsx)("input",{value:s,onChange:e=>r(e.target.value),placeholder:"Email",className:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-transparent px-3 py-2"}),(0,a.jsx)("input",{value:u,onChange:e=>m(e.target.value),placeholder:"Password",type:"password",className:"w-full rounded-md border border-slate-300 dark:border-slate-700 bg-transparent px-3 py-2"}),(0,a.jsx)("button",{onClick:()=>{var e;e=s.trim(),l&&c&&e===l&&u===c&&(localStorage.setItem(i,"ok"),1)&&t(!0)},className:"button-primary w-full",children:"Sign In"})]}),(0,a.jsx)("p",{className:"mt-3 text-xs text-[var(--muted)]",children:"Only authorized personnel."})]})});let v=p.find(e=>e.id===f)||null;return(0,a.jsxs)("div",{className:"container-responsive py-10",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"section-title",children:"Admin Panel"}),(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem(i),t(!1)},className:"button-secondary",children:"Logout"})]}),(0,a.jsxs)("div",{className:"mt-6 grid lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"lg:col-span-1 card-surface p-4",children:[(0,a.jsx)("h2",{className:"font-medium",children:"Cases"}),(0,a.jsxs)("ul",{className:"mt-2 divide-y divide-slate-200 dark:divide-slate-800",children:[p.map(e=>(0,a.jsxs)("li",{className:"py-2 flex items-center justify-between",children:[(0,a.jsxs)("button",{onClick:()=>x(e.id),className:"text-left",children:[(0,a.jsxs)("div",{className:"font-medium text-sm",children:[e.amount," ",e.currency," • ",(0,a.jsx)("span",{className:"capitalize",children:e.type})]}),(0,a.jsx)("div",{className:"text-xs text-[var(--muted)]",children:new Date(e.createdAt).toLocaleString()})]}),(0,a.jsxs)("select",{value:e.status,onChange:t=>(function(e,t){let s={...e,status:t};(0,o.MO)(s),h((0,o.Ee)()),new BroadcastChannel("csr_cases_global").postMessage({type:"case_update",id:e.id})})(e,t.target.value),className:"rounded-md border border-slate-300 dark:border-slate-700 bg-transparent px-2 py-1 text-xs",children:[(0,a.jsx)("option",{value:"intake",children:"intake"}),(0,a.jsx)("option",{value:"under_review",children:"under_review"}),(0,a.jsx)("option",{value:"action_recommended",children:"action_recommended"}),(0,a.jsx)("option",{value:"closed",children:"closed"})]})]},e.id)),0===p.length&&(0,a.jsx)("li",{className:"py-6 text-sm text-[var(--muted)]",children:"No reports yet."})]})]}),(0,a.jsx)("div",{className:"lg:col-span-2 space-y-6",children:v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"card-surface p-6",children:[(0,a.jsxs)("h2",{className:"font-medium",children:["Case ",v.id.slice(0,8)]}),(0,a.jsxs)("div",{className:"text-sm text-[var(--muted)]",children:[v.amount," ",v.currency," • ",(0,a.jsx)("span",{className:"capitalize",children:v.type})]}),(0,a.jsxs)("div",{className:"mt-3 grid md:grid-cols-2 gap-4 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[var(--muted)]",children:"Timeline"}),(0,a.jsx)("div",{className:"font-medium",children:v.timeline||"—"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-[var(--muted)]",children:"Evidence"}),(0,a.jsxs)("div",{className:"font-medium",children:[v.evidence.length," file(s)"]})]})]})]}),(0,a.jsx)(d.N,{sender:"reviewer",showSystemIntro:!1,record:v,onUpdate:e=>{(0,o.MO)(e),h((0,o.Ee)()),new BroadcastChannel("csr_cases_global").postMessage({type:"message",id:e.id})}})]}):(0,a.jsx)("div",{className:"card-surface p-6 text-[var(--muted)]",children:"Select a case to view details and chat."})})]})]})}},3598:function(e,t,s){"use strict";s.d(t,{N:function(){return l}});var a=s(7437),n=s(2265),r=s(9271),i=s(2333);function l(e){var t,s,l;let{record:c,onUpdate:o,sender:d="victim",showSystemIntro:u=!0}=e,[m,p]=(0,n.useState)(""),[h,f]=(0,n.useState)([]),[x,v]=(0,n.useState)(!1),g=(0,n.useRef)(null),{post:y}=(s=c.id,l=e=>{(null==e?void 0:e.type)==="message"&&e.caseId===c.id&&o({...c,messages:[...c.messages||[],e.message]}),(null==e?void 0:e.type)==="typing"&&e.caseId===c.id&&v(!!e.agent)},(0,n.useEffect)(()=>{if(!s)return;let e=new BroadcastChannel("csr_chat_".concat(s)),t=e=>l(e.data);return e.addEventListener("message",t),()=>e.removeEventListener("message",t)},[s,l]),{post:e=>{s&&new BroadcastChannel("csr_chat_".concat(s)).postMessage(e)}});async function b(e){e&&f(Array.from(e).slice(0,5))}async function j(){if(!m.trim()&&0===h.length)return;let e=[];for(let t of h){let s=await (0,i.O)(t),a=t.type.startsWith("image/")?await new Promise(e=>{let s=new FileReader;s.onload=()=>e(String(s.result)),s.readAsDataURL(t)}):void 0;e.push({name:t.name,type:t.type,size:t.size,hash:s,previewDataUrl:a})}let t={id:crypto.randomUUID(),from:d,text:m.trim(),at:Date.now(),status:"sent",attachments:e},s={...c,messages:[...c.messages||[],t]};(0,r.MO)(s),o(s),y({type:"message",caseId:c.id,message:t}),p(""),f([]),"victim"===d&&(v(!0),y({type:"typing",caseId:c.id,agent:!0}),setTimeout(()=>{let e={id:crypto.randomUUID(),from:"reviewer",text:"Your case is being reviewed. We will follow up shortly with next steps.",at:Date.now(),status:"delivered"},t={...s,messages:[...s.messages||[],e]};(0,r.MO)(t),o(t),y({type:"message",caseId:c.id,message:e}),v(!1),y({type:"typing",caseId:c.id,agent:!1})},1e3))}return(0,n.useEffect)(()=>{var e;null===(e=g.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[null===(t=c.messages)||void 0===t?void 0:t.length]),(0,n.useEffect)(()=>{if(u&&!(c.messages||[]).some(e=>"system"===e.from)){let e={id:crypto.randomUUID(),from:"system",text:"Thanks for your report. We will assign a Recovery Unit agent to this chat shortly.",at:Date.now()},t={...c,messages:[...c.messages||[],e]};(0,r.MO)(t),o(t)}},[u]),(0,a.jsxs)("div",{className:"card-surface p-4",children:[(0,a.jsx)("h3",{className:"font-medium",children:"Secure Chat"}),(0,a.jsxs)("div",{className:"mt-3 h-64 overflow-y-auto rounded-md border border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-950 p-3 space-y-2",children:[(c.messages||[]).map(e=>{var t;return(0,a.jsxs)("div",{className:"max-w-[80%] rounded-md px-3 py-2 text-sm ".concat("victim"===e.from?"ml-auto bg-brand-green text-white":"reviewer"===e.from?"bg-slate-200 dark:bg-slate-800":"mx-auto bg-slate-100 dark:bg-slate-900"),children:[(0,a.jsx)("div",{children:e.text}),(null===(t=e.attachments)||void 0===t?void 0:t.length)?(0,a.jsx)("div",{className:"mt-2 grid grid-cols-2 gap-2",children:e.attachments.map((e,t)=>(0,a.jsx)("div",{className:"rounded border border-slate-200 dark:border-slate-800 p-2",children:e.previewDataUrl?(0,a.jsx)("img",{src:e.previewDataUrl,alt:e.name,className:"w-full h-24 object-cover rounded"}):(0,a.jsxs)("div",{className:"text-xs text-[var(--muted)]",children:[e.name," • ",(e.size/1024).toFixed(1)," KB"]})},t))}):null,(0,a.jsxs)("div",{className:"mt-1 text-xs opacity-80 flex items-center gap-2",children:[(0,a.jsx)("span",{children:new Date(e.at).toLocaleTimeString()}),e.status?(0,a.jsxs)("span",{children:["• ",e.status]}):null]})]},e.id)}),x&&(0,a.jsxs)("div",{className:"max-w-[80%] rounded-md px-3 py-2 text-sm bg-slate-200 dark:bg-slate-800 inline-flex items-center gap-2",children:[(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce"}),(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce [animation-delay:120ms]"}),(0,a.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-slate-500 animate-bounce [animation-delay:240ms]"})]}),(0,a.jsx)("div",{ref:g})]}),h.length>0&&(0,a.jsxs)("div",{className:"mt-2 text-xs text-[var(--muted)]",children:[h.length," attachment(s) ready"]}),(0,a.jsxs)("div",{className:"mt-3 flex items-center gap-2",children:[(0,a.jsx)("input",{value:m,onChange:e=>p(e.target.value),placeholder:"Write a message",className:"flex-1 rounded-md border border-slate-300 dark:border-slate-700 bg-transparent px-3 py-2","aria-label":"Message"}),(0,a.jsxs)("label",{className:"button-secondary cursor-pointer",children:[(0,a.jsx)("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>b(e.target.files),accept:"image/*,application/pdf,text/plain"}),"Attach"]}),(0,a.jsx)("button",{onClick:j,className:"button-primary",children:"Send"})]}),(0,a.jsx)("p",{className:"mt-2 text-xs text-[var(--muted)]",children:"We will assign a Recovery Unit agent to this chat promptly."})]})}},2333:function(e,t,s){"use strict";async function a(e){let t=await e.arrayBuffer();return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>e.toString(16).padStart(2,"0")).join("")}s.d(t,{O:function(){return a}})},9271:function(e,t,s){"use strict";s.d(t,{Ee:function(){return n},MO:function(){return r},S:function(){return i}});let a="csr_cases_v1";function n(){try{let e=localStorage.getItem(a);if(!e)return[];return JSON.parse(e)}catch(e){return[]}}function r(e){let t=n(),s=t.findIndex(t=>t.id===e.id);s>=0?t[s]=e:t.unshift(e),localStorage.setItem(a,JSON.stringify(t))}function i(e){return n().find(t=>t.id===e)||null}},357:function(e,t,s){"use strict";var a,n;e.exports=(null==(a=s.g.process)?void 0:a.env)&&"object"==typeof(null==(n=s.g.process)?void 0:n.env)?s.g.process:s(8081)},8081:function(e){!function(){var t={229:function(e){var t,s,a,n=e.exports={};function r(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function l(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(s){try{return t.call(null,e,0)}catch(s){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{s="function"==typeof clearTimeout?clearTimeout:i}catch(e){s=i}}();var c=[],o=!1,d=-1;function u(){o&&a&&(o=!1,a.length?c=a.concat(c):d=-1,c.length&&m())}function m(){if(!o){var e=l(u);o=!0;for(var t=c.length;t;){for(a=c,c=[];++d<t;)a&&a[d].run();d=-1,t=c.length}a=null,o=!1,function(e){if(s===clearTimeout)return clearTimeout(e);if((s===i||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(e);try{s(e)}catch(t){try{return s.call(null,e)}catch(t){return s.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function h(){}n.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)t[s-1]=arguments[s];c.push(new p(e,t)),1!==c.length||o||l(m)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=h,n.addListener=h,n.once=h,n.off=h,n.removeListener=h,n.removeAllListeners=h,n.emit=h,n.prependListener=h,n.prependOnceListener=h,n.listeners=function(e){return[]},n.binding=function(e){throw Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw Error("process.chdir is not supported")},n.umask=function(){return 0}}},s={};function a(e){var n=s[e];if(void 0!==n)return n.exports;var r=s[e]={exports:{}},i=!0;try{t[e](r,r.exports,a),i=!1}finally{i&&delete s[e]}return r.exports}a.ab="//";var n=a(229);e.exports=n}()}},function(e){e.O(0,[971,23,744],function(){return e(e.s=2379)}),_N_E=e.O()}]);